(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([[110],{1912:function(e,t,n){"use strict";n.d(t,"e",function(){return l});n.d(t,"t",function(){return h});var r=n(74),i=n(119),s=n(41),o=n(1043),u=n(123),a=n(79),f=n(615),l="https://outlook.office.com/search",c={ODB:1286},h=(function(){function e(e,t){this._dataRequestor=new o.e({},{});this._pageContext=t.pageContext;this._oAuthTokenProvider=t.oAuthTokenProvider;this._sharingContextInformation&&this._sharingContextInformation.additionalTokens&&(this._substrateToken=this._sharingContextInformation.additionalTokens.substrateToken);this.initializeDataStore()}e.prototype.canUseSubstrate=function(){if(this._substrateToken)return!0;var e=!1;if(this._pageContext&&!this._pageContext.isSPO)return e;if(this._pageContext&&this._pageContext.authToken)return e;this._pageContext&&this._oAuthTokenProvider&&f.n.isFeatureEnabled(c)&&(e=!0);this._dataStore&&(e=e&&!this._dataStore.getValue("DisableSubstrateSearch",a.e.session));return e};e.prototype.disableSubstrateCallsForPicker=function(){this.initializeDataStore();this._dataStore.setValue("DisableSubstrateSearch",!0,a.e.session)};e.prototype.getSubstrateToken=function(){var e=this;if(this._substrateToken)return r.n.resolve(this._substrateToken);if(this._oAuthTokenProvider){var t=new i.e({name:"PeoplePicker.GetSubstrateToken"});return this._oAuthTokenProvider.getToken(l).then(function(e){t.end({resultType:s.e.Success});return e},function(n){if(r.n.isCanceled(n)){t.end({resultType:s.e.ExpectedFailure,resultCode:"Canceled"});return r.n.reject(n)}t.end({resultCode:"PeoplePicker.GetSubstrateTokenError",resultType:s.e.Failure,extraData:{serverErrorCode:n._serverErrorCode,message:n.message}});e.disableSubstrateCallsForPicker();return null})}return null};e.prototype.init=function(e){var t=l+"/api/v1/init?scenario=documentshare";this._dataRequestor.send({apiName:"Substrate.PeopleSearch.Init",path:t,headers:{Authorization:"Bearer "+e},needsAuthorization:!1})};e.prototype.initializeDataStore=function(){this._dataStore||(this._dataStore=new u.e("PeoplePicker",a.e.session))};return e})()},1941:function(e,t,n){"use strict";n.d(t,"e",function(){return l});n.d(t,"t",function(){return c});var r=n(74),i=n(615),s=n(119),o=n(41),u=n(123),a=n(79),f={ODB:387},l="https://graph.microsoft.com",c=(function(){function e(e,t){this._pageContext=t.pageContext;this._sharingContextInformation=t.sharingContextInformation;this._oAuthTokenProvider=t.oAuthTokenProvider;this._sharingContextInformation&&this._sharingContextInformation.additionalTokens&&(this._graphToken=this._sharingContextInformation.additionalTokens.graphToken);this.initializeDataStore()}e.prototype.canUseGraph=function(){if(this._graphToken)return!0;if(this._pageContext&&!this._pageContext.isSPO)return!1;if(this._pageContext&&this._pageContext.authToken)return!1;var e=this._pageContext&&this._oAuthTokenProvider&&i.n.isFeatureEnabled(f);this._dataStore&&(e=e&&!this._dataStore.getValue("DisableGraph",a.e.session));return e};e.prototype.disableGraphCallsForPicker=function(){this.initializeDataStore();this._dataStore.setValue("DisableGraph",!0,a.e.session)};e.prototype.getGraphToken=function(){var e=this;if(this._graphToken)return r.n.resolve(this._graphToken);if(this._oAuthTokenProvider){var t=new s.e({name:"PeoplePicker.GetGraphToken"});return this._oAuthTokenProvider.getToken(l).then(function(e){t.end({resultType:o.e.Success});return e},function(n){if(r.n.isCanceled(n)){t.end({resultType:o.e.ExpectedFailure,resultCode:"Canceled"});return r.n.reject(n)}t.end({resultCode:"PeoplePicker.GetGraphTokenError",resultType:o.e.Failure,extraData:{serverErrorCode:n._serverErrorCode,message:n.message}});e.disableGraphCallsForPicker();return null})}return null};e.prototype.initializeDataStore=function(){this._dataStore||(this._dataStore=new u.e("PeoplePicker",a.e.session))};return e})()},1950:function(e,t,n){"use strict";n.d(t,"e",function(){return p});var r=n(147),i=n(2046),s=n(82),o=n(629),u=n(1941),a=n(1912),f=n(74),l=n(64),c=(function(){function e(e,t){this._getIdentityDataSource=t.getIdentityDataSource}e.prototype.getToken=function(e,t){return this.getInstrumentedToken(e,t).then(function(e){return e.tokenInfo.token})};e.prototype.getInstrumentedToken=function(e,t){var n=Date.now();return f.n.resolve(this._getIdentityDataSource().then(function(t){return e===u.e&&t.getGraphToken?t.getGraphToken({resource:e}):e===a.e&&t.getSubstrateToken?t.getSubstrateToken(o.e.Default):t.getOAuthSessionToken?t.getOAuthSessionToken(e):void 0}).then(function(e){var t=null==e?void 0:e.accessToken;if(!e||!t)throw new l.e({code:"UnableToResolveToken"});return{tokenInfo:{token:t,isGuest:!1,expirationTimeMs:e.tokenExpiry},spRequestId:e.correlationId||"",spRequestTimestamp:n}}))};return e})(),h=Object(r.s)("OAuthTokenDataSource",c,{getIdentityDataSource:s.S.async.lazy}),p=Object(r.s)("OAuthTokenProviderBase",i.e,{oAuthTokenDataSource:h})},2046:function(e,t,n){"use strict";var r,i=n(74),s=n(119),o=n(41);(function(e){e[e.InteractionRequired=10013]="InteractionRequired"})(r||(r={}));var u=(function(){function e(e,t){void 0===e&&(e={});this._dataSource=t.oAuthTokenDataSource}e.prototype.getToken=function(e,t){var n=new s.e({name:"getToken"});return this._dataSource.getToken(e,t).then(function(e){n.end({resultType:o.e.Success});return e},function(e){n.end({resultType:o.e.Failure});return i.n.reject(e)})};e.prototype.getInstrumentedToken=function(e,t){var n=new s.e({name:"getToken"});return this._dataSource.getInstrumentedToken(e,t).then(function(e){n.end({resultType:o.e.Success});return e},function(e){n.end({resultType:o.e.Failure});return i.n.reject(e)})};return e})();t.e=u},2118:function(e,t,n){"use strict";var r=n(2227),i=n(128),s=n(1844),o=n(41),u=n(210),a=n(30),f=n(74),l=n(1050),c=n(1907),h=new RegExp("^Templates$","i"),p=(function(){function e(){}e.isFolder=function(e,t){return t?e&&(e.type===u.e.Folder||e.type===u.e.OneNote):e&&e.type===u.e.Folder};e.isCheckedOut=function(e){return l.e(e)};e.isCheckedOutByUser=function(e,t){return l.n(e,t)};e.isCheckedOutByOther=function(t,n){return e.isCheckedOut(t)&&!e.isCheckedOutByUser(t,n)};e.showCheckedOutByOtherDialog=function(e){return e.requestDialog({title:r.i,component:{name:c.e.tagName,params:{text:r.r}},actions:[{name:i.cancelActionText,execute:function(){return f.n.wrap(2)},icon:new s.e("Cancel"),isDefault:!0}]}).wait().then(function(){return{resultType:o.e.Success}})};e.isPublished=function(t,n){return n.isModerated?t.properties[e.PublishProperty]&&"3"!==t.properties[e.PublishProperty]&&"1"!==t.properties[e.PublishProperty]:0===e.getVersionNoModeration(t,n).minor&&0!==e.getVersionNoModeration(t,n).major};e.needsPublishingReminder=function(t,n){return!e.isPublished(t,n)&&(!e.isPendingApproval(t,n)&&!e.isPageTemplate(t)&&((!t.properties||!t.properties._ScheduledVersion||t.properties.owshiddenversion!==t.properties._ScheduledVersion)&&(a.e.hasItemPermission(t,a.e.editListItems)&&n.enableMinorVersions&&!e.isFolder(t,!0))))};e.isPublishingRelevant=function(t,n){return a.e.hasItemPermission(t,a.e.editListItems)&&n.enableMinorVersions&&!e.isCheckedOut(t)&&!e.isFolder(t,!0)};e.getVersionNoModeration=function(e,t){return t.isModerated?{major:0,minor:0}:this.getVersion(e,t)};e.getVersion=function(t,n){if(t&&t.properties&&t.properties[e.VersionProperty]){var r=Number(t.properties[e.VersionProperty])%512;return{major:Math.floor(Number(t.properties[e.VersionProperty])/512),minor:r}}return{major:0,minor:0}};e.isPendingApproval=function(t,n){return!!n.isModerated&&(t&&t.properties&&t.properties[e.PublishProperty]&&"2"===t.properties[e.PublishProperty])};e.isPageTemplate=function(e){if(!e.id)return!1;var t=e.id.split("/"),n=t.length;return h.test(t[n-2])};e.isApprovalRelevant=function(t,n){return n&&n.isModerated&&!e.isCheckedOut(t)&&a.e.hasItemPermission(t,a.e.editListItems)&&a.e.hasItemPermission(t,a.e.approveItems)};e.FileTypeProperty="FSObjType";e.PublishProperty="_ModerationStatus.";e.VersionProperty="_UIVersion";return e})();t.e=p},2298:function(e,t,n){"use strict";n(2299);var r=n(1950);n.d(t,"e",function(){return r.e})},2299:function(e,t){(function(e){"use strict";if(!e.fetch){var t="URLSearchParams"in e,n="Symbol"in e&&"iterator"in Symbol,r="FileReader"in e&&"Blob"in e&&(function(){try{new Blob;return!0}catch(e){return!1}})(),i="FormData"in e,s="ArrayBuffer"in e;if(s)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=function(e){return e&&DataView.prototype.isPrototypeOf(e)},a=ArrayBuffer.isView||function(e){return e&&o.indexOf(Object.prototype.toString.call(e))>-1};d.prototype.append=function(e,t){e=c(e);t=h(t);var n=this.map[e];this.map[e]=n?n+","+t:t};d.prototype.delete=function(e){delete this.map[c(e)]};d.prototype.get=function(e){e=c(e);return this.has(e)?this.map[e]:null};d.prototype.has=function(e){return this.map.hasOwnProperty(c(e))};d.prototype.set=function(e,t){this.map[c(e)]=h(t)};d.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)};d.prototype.keys=function(){var e=[];this.forEach(function(t,n){e.push(n)});return p(e)};d.prototype.values=function(){var e=[];this.forEach(function(t){e.push(t)});return p(e)};d.prototype.entries=function(){var e=[];this.forEach(function(t,n){e.push([n,t])});return p(e)};n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var f=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];w.prototype.clone=function(){return new w(this,{body:this._bodyInit})};b.call(w.prototype);b.call(x.prototype);x.prototype.clone=function(){return new x(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})};x.error=function(){var e=new x(null,{status:0,statusText:""});e.type="error";return e};var l=[301,302,303,307,308];x.redirect=function(e,t){if(-1===l.indexOf(t))throw new RangeError("Invalid status code");return new x(null,{status:t,headers:{location:e}})};e.Headers=d;e.Request=w;e.Response=x;e.fetch=function(e,t){return new Promise(function(n,i){var s=new w(e,t),o=new XMLHttpRequest;o.onload=function(){var e={status:o.status,statusText:o.statusText,headers:S(o.getAllResponseHeaders()||"")};e.url="responseURL"in o?o.responseURL:e.headers.get("X-Request-URL");var t="response"in o?o.response:o.responseText;n(new x(t,e))};o.onerror=function(){i(new TypeError("Network request failed"))};o.ontimeout=function(){i(new TypeError("Network request failed"))};o.open(s.method,s.url,!0);"include"===s.credentials&&(o.withCredentials=!0);"responseType"in o&&r&&(o.responseType="blob");s.headers.forEach(function(e,t){o.setRequestHeader(t,e)});o.send(void 0===s._bodyInit?null:s._bodyInit)})};e.fetch.polyfill=!0}function c(e){"string"!=typeof e&&(e=String(e));if(/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function h(e){"string"!=typeof e&&(e=String(e));return e}function p(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};n&&(t[Symbol.iterator]=function(){return t});return t}function d(e){this.map={};e instanceof d?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function v(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function m(e){return new Promise(function(t,n){e.onload=function(){t(e.result)};e.onerror=function(){n(e.error)}})}function g(e){var t=new FileReader,n=m(t);t.readAsArrayBuffer(e);return n}function y(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);t.set(new Uint8Array(e));return t.buffer}function b(){this.bodyUsed=!1;this._initBody=function(e){this._bodyInit=e;if(e)if("string"==typeof e)this._bodyText=e;else if(r&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(i&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(s&&r&&u(e)){this._bodyArrayBuffer=y(e.buffer);this._bodyInit=new Blob([this._bodyArrayBuffer])}else{if(!s||!ArrayBuffer.prototype.isPrototypeOf(e)&&!a(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=y(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))};if(r){this.blob=function(){var e=v(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))};this.arrayBuffer=function(){return this._bodyArrayBuffer?v(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(g)}}this.text=function(){var e=v(this);if(e)return e;if(this._bodyBlob)return(function(e){var t=new FileReader,n=m(t);t.readAsText(e);return n})(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve((function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")})(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)};i&&(this.formData=function(){return this.text().then(E)});this.json=function(){return this.text().then(JSON.parse)};return this}function w(e,t){var n,r,i=(t=t||{}).body;if(e instanceof w){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url;this.credentials=e.credentials;t.headers||(this.headers=new d(e.headers));this.method=e.method;this.mode=e.mode;if(!i&&null!=e._bodyInit){i=e._bodyInit;e.bodyUsed=!0}}else this.url=String(e);this.credentials=t.credentials||this.credentials||"omit";!t.headers&&this.headers||(this.headers=new d(t.headers));this.method=(n=t.method||this.method||"GET",r=n.toUpperCase(),f.indexOf(r)>-1?r:n);this.mode=t.mode||this.mode||null;this.referrer=null;if(("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function E(e){var t=new FormData;e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(i))}});return t}function S(e){var t=new d;e.split(/\r?\n/).forEach(function(e){var n=e.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();t.append(r,i)}});return t}function x(e,t){t||(t={});this.type="default";this.status="status"in t?t.status:200;this.ok=this.status>=200&&this.status<300;this.statusText="statusText"in t?t.statusText:"OK";this.headers=new d(t.headers);this.url=t.url||"";this._initBody(e)}})("undefined"!=typeof self?self:this)},2715:function(e,t,n){"use strict";n.d(t,"n",function(){return r});n.d(t,"e",function(){return i});n.d(t,"t",function(){return s});var r,i,s;(function(e){e[e.DownloadSingleFile=0]="DownloadSingleFile";e[e.DownloadMultiFile=1]="DownloadMultiFile";e[e.DownloadFileInZip=2]="DownloadFileInZip"})(r||(r={}));(function(e){e.Files="files";e.Recent="recent";e.Shared="shared";e.RecycleBin="recyclebin";e.Photos="photos"})(i||(i={}));(function(e){e.Navigation="NavigationRequest";e.Click="ClickRequest";e.Search="SearchRequest";e.SearchSuggestionClick="SearchSuggestionClickRequest";e.TokenResponse="TokenResponse";e.TokenRequest="OAuthTokenRequest";e.DarkModeRequest="DarkModeRequest";e.LokiTokenRequest="LokiTokenRequest";e.SubstrateTokenRequest="SubstrateTokenRequest";e.EnablePersonalVault="EnablePersonalVault"})(s||(s={}))},3115:function(e,t,n){"use strict";n.d(t,"e",function(){return s});var r=n(10),i=n(147),s=new r.t({name:"PushChannelProvider.key",loader:new i.t(function(){return n.ee([447],3387).then(function(e){return e.resourceKey})})})},3130:function(e,t,n){"use strict";var r=n(0),i=(function(e){Object(r.__extends)(t,e);function t(t){return e.call(this,{dataSourceName:"MicroServiceEndPointDataSource"},{pageContext:t})||this}t.prototype.getMicroServiceEndPoints=function(e){var t=this._pageContext.webAbsoluteUrl+"/_api/microservicemanager/getserviceurls?service='"+e+"'";return this.dataRequestor.getData({url:t,method:"GET",qosName:"GetServiceUrls"}).then(function(e){return e&&e.d&&e.d.GetServiceUrls&&e.d.GetServiceUrls.results&&e.d.GetServiceUrls.results[0]})};t.prototype.getAllMicroServiceEndPoints=function(e){var t=this._pageContext.webAbsoluteUrl+"/_api/microservicemanager/getserviceurls?service='"+e+"'";return this.dataRequestor.getData({url:t,method:"GET",qosName:"GetAllServiceUrls"}).then(function(e){return e&&e.d&&e.d.GetServiceUrls&&e.d.GetServiceUrls.results})};return t})(n(1145).t);t.e=i},3500:function(e,t,n){"use strict";n.d(t,"e",function(){return a});var r=n(0),i=n(3130),s=n(147),o=n(54),u=(function(e){Object(r.__extends)(t,e);function t(t,n){return e.call(this,n.pageContext)||this}return t})(i.e),a=Object(s.s)("MicroserviceEndPointDataSource.key",u,{pageContext:o.h})},3810:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(74),s=n(2118),o=n(721),u=n(82),a=n(1832),f=n(210),l=n(41),c=n(1866),h=n(182),p=n(2501),d=n(1368),v=n(110),m=n(32),g=n(10),y=n(147),b=n(81),w=n(3115),E=n(2298),S=n(3500),x=n(129),T=n(1065),N=n(64),C=n(2715),k=new g.t({name:"DownloadExecutor",loader:new y.t(function(){return i.n.resolve(n.ee([108],4346)).then(function(e){return e.typeResourceKey})})}),L=(function(e){Object(r.__extends)(t,e);function t(t){var n=e.call(this,t)||this;n._sessionManagementProvider=n.resources.consume(d.e.optional);n._platform=n.resources.consume(h.e);n._oAuthTokenProvider=n.resources.consume(E.e.optional);n._navigation=n.resources.consume(v.e);n._hiddenDomProvider=n.resources.consume(p.e);n.selectionHelper=t.selectionHelper;n.currentItem=t.currentItem;n.dialogProvider=n.resources.consume(c.e);n.isOneDriveWinApp=Object(x.e)();return n}t.prototype.execute=function(e,t){var n,r=this,s=this.selectionHelper.selection;n={items:s.peek().map(function(e){return e.peek()})};return this.onPreDownloadItems(n.items).then(function(e){if(e){if(r.isOneDriveWinApp){1===n.items.length&&n.items[0].type!==f.e.Folder?r.resources.consumeAsync(u.a).then(function(e){var t=n.items[0];e.getDownloadUrl(t,{downloadType:0}).then(function(e){r.resources.consumeAsync(T.e).then(function(n){var r={command:"Download",type:C.n.DownloadSingleFile,downloadUrl:e,zipFileName:t.displayName};n.sendCommand({command:JSON.stringify({DownloadCommand:r})})})})}):r.resources.consumeAsync(u.a).then(function(e){e.getDownloadZipRequest(n).then(function(e){r.resources.consumeAsync(T.e).then(function(t){t.sendCommand({command:e})})})});return{resultType:l.e.Success}}return r.resources.consumeAsync(u.a).then(function(e){return e.downloadItems(n).then(function(){var e={},t={count:n.items.length};if(1===n.items.length){e.fileType=f.e[n.items[0].type];e.extension=n.items[0].extension||""}return{resultType:l.e.Success,extraData:e,extraMetrics:t}})})}return i.n.wrap({resultType:l.e.ExpectedFailure})})};t.prototype.executeVroomDownload=function(e){var n=this,r=e.itemsData,s=e.docIds,o=e.zipApiUrl,u=e.provider,a=(e.method,e.appId),f=(e.loggingEvent,e.fileDisplayName);if(!(t.doc_ids===s&&Date.now()-t.last_download<5e3)){t.last_download=Date.now();t.doc_ids=s;var l=function(){return n._doDownload(r,s,o,u,null,null,a,f||"")};if(r&&-1!==r[0].docId.indexOf("access_token")||"spo"===u&&this._oAuthTokenProvider)try{return i.n.resolve(this.resources.consumeAsync(S.e)).then(function(e){return e.getMicroServiceEndPoints("media")}).then(function(e){return n._oAuthTokenProvider.getToken(e,!0)}).then(function(e){return n._doDownload(r,s,o,u,null,e,a,f||"")},l)}catch(e){return l()}return this._sessionManagementProvider.getToken().then(function(e){return n._doDownload(r,s,o,u,e,null,a,f||"")},function(e){if(e instanceof N.e&&"unauthUser"===e.code)return l()})}};t.prototype.onPreDownloadItems=function(e){return i.n.wrap(!0)};t.prototype._doDownload=function(e,t,n,r,i,s,o,u){return e?this._completeDownloadasZip(e,n,r,i,s,o):this._completeDownloadFile(n,i,u)};t.prototype._completeDownloadFile=function(e,t,n){e+=t?"?access_token="+t.accessToken:"";this.isOneDriveWinApp&&this.resources.consumeAsync(T.e).then(function(t){var r={command:"Download",type:C.n.DownloadSingleFile,downloadUrl:e,zipFileName:n};t.sendCommand({command:JSON.stringify({DownloadCommand:r})})});if(this._platform.isMobile){this._navigation.navigateTo({url:e,frameId:"_self"});return i.n.wrap({resultType:l.e.Success})}if(this._platform.isIE){this._downloadForIE("od-download-tab",e);return i.n.wrap({resultType:l.e.Success})}var r=Math.random(),s=this._getDownloadIframe(r);document.body.appendChild(s);s.src=e;this.async.setTimeout(function(){s.remove()},2e4);return i.n.wrap({resultType:l.e.Success})};t.prototype._completeDownloadasZip=function(e,n,r,s,o,u){var a=this;t.zip_count++;var f=b.e.generate(),c="OneDrive_"+t.zip_count+"_"+(new Date).toLocaleDateString().replace(/\//g,"-").replace(/[^ -~]/g,"")+".zip";e&&1===e.length&&(c=e[0].name+".zip");return i.n.resolve(this.resources.consumeAsync(w.e.optional)).then(function(t){var i,h=t&&t.getNotificationUrl()||"";h&&Object(m.isFeatureEnabled)(m.DownloadNotifications)&&a.resources.consumeAsync(k).then(function(e){var t=new e({items:[],guid:f,zipFileName:c});a.trackPromise(t.start());t.wait()});var p=2e4;if(a._platform.isIE){i=a._downloadForIE("od-download-tab");p=5e3}if(a.isOneDriveWinApp){var d={files:JSON.stringify({items:e}),notificationUrlValue:h,guid:f,provider:r,zipFileName:c,oAuthToken:o||"",accessToken:s&&s.accessToken||"",appId:u},v={command:"Download",type:C.n.DownloadMultiFile,downloadUrl:n,zipFileName:c,postBody:JSON.stringify({request:d})};a.resources.consumeAsync(T.e).then(function(e){e.sendCommand({command:JSON.stringify({DownloadCommand:v})})});return{resultType:l.e.Success}}var g=Math.random(),y=a._getDownloadIframe(g),b=a._hiddenDomProvider.requestControl({name:"od-downloadaszip",params:{filesValue:JSON.stringify({items:e}),notificationUrlValue:h,guid:f,formAction:n,providerValue:r,id:g,zipFileName:c,target:a._platform.isIE?"od-download-tab":y.id,oAuthToken:o||"",accessToken:s&&s.accessToken||"",appId:u||"",resources:a.resources}}),w=document.getElementById("form_download_as_zip"+g);w.parentNode.appendChild(y);w.submit();var E=a.addDisposable({dispose:function(){a._hiddenDomProvider.disposeControl(b)}});a.async.setTimeout(function(){E.dispose();i&&i.close()},p);return{resultType:l.e.Success}})};t.prototype._getDownloadIframe=function(e){var t=document.createElement("iframe");t.id="od-download-iframe"+e;t.name=t.id;t.hidden=!0;return t};t.prototype._downloadForIE=function(e,t){void 0===t&&(t="");var n;n=window.open(t,e);this.async.setTimeout(function(){n.close()},5e3);return n};t.zip_count=0;return t})(a.n),A=n(155);Object(A.n)([{rawString:".od-DownloadAsZip{visibility:hidden}"}]);var O=(function(e){Object(r.__extends)(t,e);function t(t){var n=e.call(this,t)||this;n.formAction=t.formAction;n.filesValue=t.filesValue;n.providerValue=t.providerValue;n.id="form_download_as_zip"+t.id;n.notificationUrlValue=t.notificationUrlValue;n.accessToken=t.accessToken;n.zipFileName=t.zipFileName;n.target=t.target;n.oAuthToken=t.oAuthToken;n.guid=t.guid;n.method=t.method||"Post";n.appId=t.appId;return n}return t})(n(1834).t),M=(n(1835).e({tagName:"od-downloadaszip",template:'<div id="od-Download-As-Zip" class="od-DownloadAsZip"><form class="DownloadAsZipForm" name="form_download_as_zip" data-bind="attr:{action:formAction,target:target,id:id,method:method}"><input id="download_input_1" name="provider" type="hidden" data-bind="value:providerValue"><input id="download_input_2" name="guid" type="hidden" data-bind="value:guid"><input id="download_input_3" name="files" type="hidden" data-bind="value:filesValue"><input id="download_input_4" name="notificationUrl" type="hidden" data-bind="value:notificationUrlValue"><input id="download_input_5" name="accessToken" type="hidden" data-bind="value:accessToken"><input id="download_input_6" name="zipFileName" type="hidden" data-bind="value:zipFileName"><input id="download_input_7" name="oAuthToken" type="hidden" data-bind="value:oAuthToken"><input id="download_input_8" name="appId" type="hidden" data-bind="value:appId"></form></div>',viewModel:O,synchronous:!0}),n(164)),_=(function(e){Object(r.__extends)(t,e);function t(t){return e.call(this,t)||this}t.prototype.execute=function(t,n){var r=this,a=this.selectionHelper.selection.peek();n.data.extraData||(n.data.extraData={});return a.length>1||s.e.isFolder(a[0].peek(),!1)?i.n.resolve(this.resources.consumeAsync(u.b)).then(function(t){var u="",l=0,c=0,h=Object(m.isFeatureEnabled)(m.MediaTAUseVroomV21),p=a.map(function(e){if(e){var n=e.peek(),r=n.urls[o.t.itemUrl];u+=r;n.type===f.e.OneNote&&l++;var i=s.e.isFolder(n,!1);i&&c++;var a=t.getAccessToken(n,{apiVersion:h?"v2.1":"v2.0"});return{name:n.name,size:n.size,docId:r+(-1!==r.indexOf("?")?"&":"?")+"access_token="+a.accessToken,isFolder:i}}});if(!p)return i.n.wrapError(new Error("No item metadata for download."));p=p.filter(Boolean);M.e(n.data.extraData,{oneNotesCount:l,filesCount:a.length-c,foldersCount:c});var d=a[0].peek().urls[o.t.downloadAsZip];return e.prototype.executeVroomDownload.call(r,{itemsData:p,docIds:u,zipApiUrl:d,provider:"spo",method:"POST",appId:"",loggingEvent:n})}):e.prototype.execute.call(this,t,n)};return t})(L);t.default=_}}]);