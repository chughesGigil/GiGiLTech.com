(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([[169],{2387:function(e,t,n){"use strict";n.d(t,"e",function(){return m});var r=n(0),i=n(32),s=n(1832),o=n(147),u=n(123),a=n(79),f=n(110),l=n(223),c=n(1157),h=n(842),p=n(185),d={campaignGuid:"00000000-0000-0000-0000-000000000000",endDate:new Date(1970,1,1),flag:i.Off,isCoachmark:!0},v=(function(e){Object(r.__extends)(t,e);function t(t,n){void 0===t&&(t={});var r=e.call(this,t,n)||this;r._dataStore=new u.e("CoachmarkProvider",a.e.session);r._currentCampaign=r.createObservable(d);r._isVisible=r.createObservable(!1);r._navigation=n.navigation;r._firstRunExperienceStatus=n.firstRunExperienceStatus;r._currentTeachingBubble=r.createObservable({campaign:r._currentCampaign,isVisible:r._isVisible});r._navigation.viewParams.resetAllBubbles&&r._dataStore.remove("CoachmarkTearDropSeen");var i=r.resources.consume(p.e);r._teachingBubbleProviderPromise=i.waitForPLT().then(function(){return r.resources.consume(l.T)});return r}Object.defineProperty(t.prototype,"isVisible",{get:function(){return this._isVisible},enumerable:!1,configurable:!0});Object.defineProperty(t.prototype,"currentCampaign",{get:function(){return this._currentCampaign},enumerable:!1,configurable:!0});t.prototype.hideCampaign=function(){this._isVisible(!1);this._currentCampaign(d)};t.prototype.setCampaign=function(e){var t=this;if(e){if(this._firstRunExperienceStatus.get()!==h.e.visible){var n=e.name+"CoachmarkTearDropSeen";this._dataStore.getValue("CoachmarkTearDropSeen")||this._teachingBubbleProviderPromise.then(function(r){r&&r.shouldBubbleBeAdded(e,!1).then(function(r){if(r){t._currentCampaign(e);t._isVisible(!0);t._dataStore.setValue(n,!0)}})})}}else{this._currentCampaign(d);this._isVisible(!1)}};t.prototype.getCurrentTeachingBubble=function(){return this._currentTeachingBubble};t.dependencies=Object(r.__assign)(Object(r.__assign)({},s.n.dependencies),{navigation:f.e,firstRunExperienceStatus:c.e});return t})(s.n),m=Object(o.s)("CoachmarkProvider",v)},4285:function(e,t,n){"use strict";n.r(t);n.d(t,"OpenInImageEditorHandler",function(){return x});var r=n(0),i=n(182),s=n(2151),o=n(1832),u=n(74),a=n(82),f=n(1860),l=n(1947),c=n(26),h=n(129),p=n(2160),d=n(32),v=n(1180),m=n(631),g=n(2387),y=n(210),b={jpg:"image/jpg",jpeg:"image/jpeg"},w={png:"image/png"},E={heic:"image/heic",heif:"image/heif"},S={bmp:"image/bmp",emf:"image/emf",gif:"image/gif",tiff:"image/tiff",tif:"image/tif",webp:"image/webp",wmf:"image/wmf"},x=(function(e){Object(r.__extends)(t,e);function t(t){void 0===t&&(t={});var n=e.call(this,t)||this;n._itemSelectionHelper=new(n.child(f.e))({allowMultiSelect:!1,canFallback:!0});n._isOneDriveWinApp=Object(h.e)();n._urlDataSource=n.resources.consume(a.ve);n._itemCommandHelper=n.resources.consume(l.t);n._platformDetection=n.resources.consume(i.e);n._identityDataSource=n.resources.consume(a.S);n._coachmarkProvider=n.resources.consume(g.e.optional);n.state=n.createPureComputed(n._computeState);return n}t.prototype.getParams=function(){return this._itemSelectionHelper.resolveFirst().then(function(e){return{item:e}})};t.prototype._computeState=function(){return{isAvailable:this._isAvailable()}};t.prototype._isAvailable=function(){var e=this._itemSelectionHelper.firstItem();if(!e)return!1;if(e.video&&e.video.burstPhotoType)return!1;var t=this._itemCommandHelper.isCommandSupported(e,p.o),n=this._isSupportedFileType(e),r=this._itemSelectionHelper.currentItem(),i=this._urlDataSource.getKeyParams(r.key),s=this._urlDataSource.getQueryType(i),o=this._shouldEnableImageEditor()&&t&&n&&(!this._platformDetection.isIE||Object(d.isFeatureEnabled)(d.EnableEditUtilityControlIE))&&(!this._platformDetection.isSafari||Object(d.isFeatureEnabled)(d.EnableEditUtilityControlSafari))&&(!this._platformDetection.isMobile||Object(d.isFeatureEnabled)(d.EnableEditUtilityControlMobile))&&!!e&&0===e.sharingRole&&s!==c.e.SharedWithMe&&!this._isOneDriveWinApp&&!this._urlDataSource.isRecycleBin(s)&&4!==e.itemStatus&&3!==e.itemStatus;o&&Object(d.isFeatureEnabled)(d.EnableEditControlTeachingBubble)&&!Object(d.isFeatureEnabled)(d.MentionTeachingUIAA)&&!Object(d.isFeatureEnabled)(d.EnableExpirationSectionForTMR)&&this._coachmarkProvider.setCampaign(m.PHOTO_EDIT);return o};t.prototype._shouldEnableImageEditor=function(){if(Object(d.isFeatureEnabled)(d.EnableEditUtilityControl))return!0;if(Object(d.isFeatureEnabled)(d.EnableEditControlExperimentAA)){if(this._identityDataSource){var e=this._identityDataSource.getIdentity();e&&v.t.init({userLoginName:e.email})}var t={name:"EnableEditControlExperiment",startDate:"2/09/2021",version:v.e.v2};return new v.t(t,d.EnableEditControlExperimentAB).isOn()}return!1};t.prototype._isSupportedFileType=function(e){if(!(function(e){Object(d.isFeatureEnabled)(d.EnableEditAllImageFormats)&&C.forEach(function(e){N.push(e);N.push(e.toUpperCase())});if(Object(d.isFeatureEnabled)(d.EnableEditPNG)){N.push(".png");N.push(".PNG")}if(Object(d.isFeatureEnabled)(d.EnableEditHEIC)){N.push(".heic");N.push(".heif");N.push(".HEIC");N.push(".HEIF")}return N.some(function(t){return e.toLowerCase()===t})})(e.extension||""))return!1;if(e&&e.extension&&(e.type===y.e.File||e.type===y.e.Media)){var t=e.extension;t=((t&&"."===t[0]?t.substring(1):t)||"").toLowerCase();if(b.hasOwnProperty(t))return!0;if(Object(d.isFeatureEnabled)(d.EnableEditPNG)&&w.hasOwnProperty(t))return!0;if(Object(d.isFeatureEnabled)(d.EnableEditHEIC)&&E.hasOwnProperty(t))return!0;if(Object(d.isFeatureEnabled)(d.EnableEditAllImageFormats)&&S.hasOwnProperty(t))return!0}return!1};return t})(o.n),T=Object(s.e)({name:"OpenInImageEditor",source:{moduleDefinition:{path:"./OpenInImageEditorExecutor",getModule:function(){return u.n.resolve(n.ee([170,"ondemand.resx-ondemand"],4073))}}},handlerType:x}),N=[".jpg",".jpeg",".JPG",".JPEG"],C=[".bmp",".emf",".gif",".tiff",".tif",".webp",".wmf"];t.default=T}}]);